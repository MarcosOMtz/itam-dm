---
title: 'Análisis exploratorio: algas'
author: "Equipo CAL (Carlos, Amanda, Liliana)"
date: "Noviembre 2014"
output: html_document
---

```{r, echo = FALSE, eval=TRUE}
# Limpiamos objetos
rm(list = ls())  

# Cerramos gráficas
graphics.off()
```

```{r, warning=FALSE, message=FALSE, error=FALSE, echo=FALSE, eval=TRUE}
# Cargamos las librerías necesarias para el proceso
library(plyr)
library(tidyr)
library(dplyr)
library(ggplot2)
library(directlabels)
library(lubridate)
library(stringr)
library(corrplot)
```

```{r, echo = FALSE, eval=TRUE}
# Guardamos la ruta de trabajo
ds.path <- 'C:/Users/Amanda/Documents/GitHub/itam-dm/alumnos/equipos/CAL/algas'
#ds.path <- 'J:/Maestria/2_Mineria_Datos_II/CAL/algas'

# Definimos directorio de trabajo
setwd(ds.path)

# Definimos nombre de la base
ds.name <- 'algas'

# Definimos la ruta de donde se obtendrán los datos
ds.url <- paste(ds.path, '/', ds.name, '.txt', sep = '')

# Cargamos nuestro archivo de funciones utils_algas.r
source('utils_algas.r')

# Cargamos la base de análisis
source('0-load_algas.r')

# Para obtener un print mejorado
ds <- tbl_df(ds)
```

# Introducción

El archivo con la información se obtuvo del repositorio de Adolfo de Unanue Tiscareño [https://github.com/nanounanue/itam-dm/tree/master/data/algas] (https://github.com/nanounanue/itam-dm/tree/master/data/algas).

La base de datos "algas" proviene de la 1999 Computational Intelligence and Learning (COIL) competition, ésta contiene mediciones de concentraciones químicas en los rios y densidades de algas.

La base de datos se obtuvo de un estudio sobre calidad del agua, la muestra se tomó en sitios de diferentes ríos europeos durante un periodo de aproximadamente un año. Las muestras fueron analizadas con varias sustancias químicas y en paralelo fueron recolectadas muestras de algas para determinar la distribución poblacional de éstas.

## Variables

La base consta de 18 variables que corresponden a la estación del año en la que la muestra fue tomada, la medida del río, la velocidad del fluido, 8 valores de concentraciones químicas relevantes para la distribución poblacional de algas. Las últimas 7 variables corresponden a la distribución de diferentes tipos de algas, donde los valores 0.0 significan que las frecuencias son muy pequeñas.  

El set contiene 18 atributos en el siguiente orden: 

|campo|atributo|valores|tipo|
|:---:|:------:|:--:|:---:|
|1|temporada|spring, summer, autumn, winter|categórica|
|2|tamaño del río| small, medium, large|categórica|
|3|velocidad|low, medium, large|categórica|
|4-11|concentraciones químicas|reales positivos|continua|
|12-18|distribución de diferentes tipos de algas|reales positivos|continua|

Los NA están codificados como XXXXXXX.

# Estructura general

Se muestra la estructura general de la base

```{r, echo = FALSE, eval=TRUE}
ds
```

Podemos observar las 18 diferentes variables que contiene la base, donde las 3 primeras parecen ser categóricas y el resto numéricas.

## Tamaño

Se muestra la dimensión de la base.

```{r, echo = FALSE, eval=TRUE}
dim(ds)
```

La base contiene 200 registros para cada una de las 18 variables.

## Columnas

Se muestran los nombres de la base.

```{r, echo = FALSE, eval=TRUE}
names(ds)
```

## Estructura

Se muestra la estructura de la base.

```{r, echo = FALSE, eval=TRUE}
str(ds)
```

Aparentemente no se observa ninguna discrepancia entre los nombres de las variables y la información que se presenta, tenemos que las tres primeras variables corresponden a datos de tipo caracter, que representan diferentes categorías; mientas que el resto de las variables son datos numéricos. Todo lo anterior parece acorde a la descripción que tenemos de la base.

```{r, echo = FALSE, eval=TRUE}
# Categorías de la variable temporada
cat.temporada <- unique(ds$temporada)
print('Las categorias de la variable temporada son:')
cat.temporada

# Categorías de la variable river.size
cat.tamaño <- unique(ds$tamaño)
print('Las categorias de la variable tamaño son:')
cat.tamaño

# Categorías de la variable fluid.velocity
cat.velocidad <- unique(ds$velocidad)
print('Las categorias de la variable velocidad son:')
cat.velocidad

#4-11 Concentraciones químicas
print('La estructura de las variables númericas sobre concentraciones químicas es:')
str(ds[,4:11])

#12-19 Distribuciones de diferentes algas
print('La estructura de las variables númericas sobre distribuión de los diferentes tipos de algas es:')
str(ds[,12:18])
```

## Observaciones

Se muestran las primeras observaciones que contiene la base.

```{r, echo = FALSE, eval=TRUE}
head(ds)
```

Se muestran las últimas observaciones que contiene la base.

```{r, echo = FALSE, eval=TRUE}
tail(ds)
```

Se muestra un grupo de observaciones que contiene la base que fueron seleccionadas aleatoriamente.

```{r, echo = FALSE, eval=TRUE}
sample_n(ds,6)
```

# Sumario Estadístico

Se muestra el resumen estadístico de la base, donde aparentemente no se observa algo raro. Se puede identificar es que hay variables con valores faltantes y que los valores para las últimas 7 variables son relativamente pequeños.

```{r, echo = FALSE, eval=TRUE}
summary(ds)
```

# Identificación de id

Dado que la base no cuenta con una columna correspondiente al id, agregamos la variable correspondiente.

# Limpieza de metadatos

Verificamos el formato de los nombres de las variables y observamos que no todos tienen el formato deseado, por lo que aplicaremos una limpieza.

```{r, echo = FALSE, eval=TRUE}
names(ds)
```

# Recodificación

Aparentemente la base no requiere ninguna recodificación. Las variables categóricas tienen a lo más 4 niveles y no hay variables de fechas.

# Ajuste de formatos

Se muestran las diferentes clases de las variables.

```{r, echo = FALSE, eval=TRUE}
sapply(ds, class)
```

Tenemos que las tres primeras variables son de tipo caracter y el resto numéricas, aparentemente el único ajuste que debemos realizar es definir como factores a las variables tipo caracter, para que posteriormente puedan ser utilizadas en el análisis. 

# Normalizar niveles

Removemos espacios, puntuaciones, etc. en los niveles de los factores. En este caso, la base no requirió de normalizar niveles.

# Transformación de variables

Aparentemente no es necesario hacer ninguna transformación a los datos. En el análisis gráfico trataremos de identificar si se requiere alguna transformación.

```{r, echo=FALSE, eval=TRUE}
# Realizamos los cambios que requiera la base
source('1-prepare_algas.r')
```

## Verificación de los cambios

Una vez aplicado nuestro proceso de preparación para limpieza de metadatos y ajuste de formatos tenemos lo siguiente:

Verificamos como quedan los nombres de las variables de la base.

```{r, echo = FALSE, eval=TRUE}
names(ds)
```

Así queda el ajuste sobre el tipo de variables.

```{r, echo = FALSE, eval=TRUE}
sapply(ds, class)  
```

# Análisis gráfico

Con la finalidad de observar el comportamiento de las variables que contiene la base, se obtienen las gráficas correspondientes para cada una de las variables.

Asimismo, se obtienen gráficas de la relación entre cada par de variables que se podría tener.

```{r, warning=FALSE, message=FALSE, error=FALSE, echo=FALSE, eval=TRUE}
source('2-eda_algas.r')
```

### Apéndice: Ambiente

```{r, echo=FALSE, eval=TRUE}
sessionInfo()
```
